;实验六内容一

DATA SEGMENT
	SAW_WAVE DB 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
		DB 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31
		DB 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47
		DB 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63
		DB 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79
		DB 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95
		DB 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111
		DB 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127
		DB 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143
		DB 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159
		DB 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175
		DB 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191
		DB 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207
		DB 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223
		DB 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239
		DB 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255
	TRIANGLE_WAVE DB 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31
		DB 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63
		DB 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95
		DB 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127
		DB 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159
		DB 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191
		DB 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223
		DB 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255
		DB 255, 253, 251, 249, 247, 245, 243, 241, 239, 237, 235, 233, 231, 229, 227, 225
		DB 223, 221, 219, 217, 215, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193
		DB 191, 189, 187, 185, 183, 181, 179, 177, 175, 173, 171, 169, 167, 165, 163, 161
		DB 159, 157, 155, 153, 151, 149, 147, 145, 143, 141, 139, 137, 135, 133, 131, 129
		DB 127, 125, 123, 121, 119, 117, 115, 113, 111, 109, 107, 105, 103, 101, 99, 97
		DB 95, 93, 91, 89, 87, 85, 83, 81, 79, 77, 75, 73, 71, 69, 67, 65
		DB 63, 61, 59, 57, 55, 53, 51, 49, 47, 45, 43, 41, 39, 37, 35, 33
		DB 31, 29, 27, 25, 23, 21, 19, 17, 15, 13, 11, 9, 7, 5, 3, 1
	SINE_WAVE DB 128, 131, 134, 137, 140, 143, 146, 149, 152, 155, 158, 162, 165, 167, 170, 173
		DB 176, 179, 182, 185, 188, 190, 193, 196, 198, 201, 203, 206, 208, 211, 213, 215
		DB 218, 220, 222, 224, 226, 228, 230, 232, 234, 235, 237, 238, 240, 241, 243, 244
		DB 245, 246, 248, 249, 250, 250, 251, 252, 253, 253, 254, 254, 254, 255, 255, 255
		DB 255, 255, 255, 255, 254, 254, 254, 253, 253, 252, 251, 250, 250, 249, 248, 246
		DB 245, 244, 243, 241, 240, 238, 237, 235, 234, 232, 230, 228, 226, 224, 222, 220
		DB 218, 215, 213, 211, 208, 206, 203, 201, 198, 196, 193, 190, 188, 185, 182, 179
		DB 176, 173, 170, 167, 165, 162, 158, 155, 152, 149, 146, 143, 140, 137, 134, 131
		DB 128, 124, 121, 118, 115, 112, 109, 106, 103, 100, 97, 93, 90, 88, 85, 82
		DB 79, 76, 73, 70, 67, 65, 62, 59, 57, 54, 52, 49, 47, 44, 42, 40
		DB 37, 35, 33, 31, 29, 27, 25, 23, 21, 20, 18, 17, 15, 14, 12, 11
		DB 10, 9, 7, 6, 5, 5, 4, 3, 2, 2, 1, 1, 1, 0, 0, 0
		DB 0, 0, 0, 0, 1, 1, 1, 2, 2, 3, 4, 5, 5, 6, 7, 9
		DB 10, 11, 12, 14, 15, 17, 18, 20, 21, 23, 25, 27, 29, 31, 33, 35
		DB 37, 40, 42, 44, 47, 49, 52, 54, 57, 59, 62, 65, 67, 70, 73, 76
		DB 79, 82, 85, 88, 90, 93, 97, 100, 103, 106, 109, 112, 115, 118, 121, 124
	WAVE_TYPE DB 0FFH ; 00H STANDS FOR SAW WAVE, 01H STANDS FOR TRIANGLE WAVE, 02H STANDS FOR SINE WAVE
DATA ENDS

STACKS SEGMENT
STACKS ENDS

CODE SEGMENT
    ASSUME CS:CODE, DS:DATA, SS:STACKS

	
MAIN PROC FAR

START:
    MOV AX, DATA
    MOV DS, AX
	
MAIN_LOOP:
	MOV AH, 01H
	INT 16H ; TEST IF THE INPUT BUFFER IS EMPTY
	JNZ JUDGE ; JUMP IF A KEY IS STRUCK
	JMP MAIN_LOOP
	
	; START CONVERSION
	MOV AX, DI
	CMP AX, 0FFH
	JNZ P1
	MOV AX, 0H
	MOV DI, AX; SET DI = 0X00 IF DI REACHES 0XFF
P1: 
	MOV AL, WAVE_TYPE
	CMP AL, 00H ; GENERATE A SAW WAVE
	JZ WAVE_SAW
	CMP AL, 01H ; GENERATE A TRIANGLE WAVE
	JZ WAVE_TRIANGLE
	CMP AL, 02H ; GENERATE A SINE WAVE
	JZ WAVE_SINE
	
DELAY: 
	MOV CX, 0FFFH ; DETERMINES THE DELAY
P2: 
	LOOP P2
	INC DI
	JMP MAIN_LOOP
	
JUDGE: 
	MOV AH, 1
	INT 21H ; GET THE KEY AND STORE THE CHAR IN AL
	
	CMP AL, 34H
	JZ EXIT ; EXIT IF KEY '4' WAS STRUCK
	
	SUB AL, 31H ; 31H IS THE ASCII FOR CHAR '1'
	MOV WAVE_TYPE, AL
	MOV DI, 00H
	
	JMP MAIN_LOOP
	
EXIT: 
	MOV AH, 4CH
	INT 21H
	
WAVE_SAW: 
	MOV DX, 280H
	MOV AL, SAW_WAVE[DI]
	OUT DX, AL
	JMP MAIN_LOOP

WAVE_TRIANGLE: 
	MOV DX, 280H
	MOV AL, TRIANGLE_WAVE[DI]
	OUT DX, AL
	JMP MAIN_LOOP


WAVE_SINE: 
	MOV DX, 280H
	MOV AL, SINE_WAVE[DI]
	OUT DX, AL
	JMP MAIN_LOOP

MAIN ENDP
CODE ENDS

END START
