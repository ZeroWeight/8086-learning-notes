DATA SEGMENT
MESS DB 'MY_MESS','$'
DATA ENDS
STACK SEGMENT PARA STACK
DW 128 DUP(?)
STACK ENDS
CODE SEGMENT
ASSUME CS:CODE,DS:DATA,ES:DATA,SS:STACK
MAIN PROC FAR
START:
MOV AX,DATA
MOV DS,AX
MOV ES,AX
MOV AL,080H
MOV DX,03FBH
OUT DX,AL
MOV AX,060H
MOV DX,03F8H
OUT DX,AL
MOV AL,AH
MOV DX,03F9H
OUT DX,AL
MOV AL,0BH
MOV DX,03FBH
OUT DX,AL
MOV AL,03H
MOV DX,03FCH
OUT DX,AL
XOR AL,AL
MOV DX,03F9H
OUT DX,AL

JOB LABEL FAR
L1:
MOV DX,3FDH
IN AL,DX
TEST AL,1EH
JNZ ERROR
TEST AL,1
JNZ REC
TEST AL,020H
JZ L1
MOV AH,1
INT 16H
JZ L1
MOV AH,1
INT 21H
MOV DX,03F8H
OUT DX,AL
CMP AL,'S'
JNZ NSEND
PUSH AX
PUSH DX
PUSH SI
LEA SI,MESS

L2:
MOV DX,03FDH
IN AL,DX
TEST AL,040H
JNZ L2
TEST AL,020H
JZ L1
MOV AL,[SI]
CMP AL,'$'
JZ SEND
MOV DX,03F8H
OUT DX,AL
INC SI
JMP L2
SEND:
POP SI
POP DX
POP AX
JMP JOB
NSEND:
CMP AL,020H
JNZ L1
MOV AX,04C00H
INT 21H
REC:
MOV DX,03F8H
IN AL,DX
CMP AL,020H
JNZ CHAR
MOV AX,04C00H
INT 21H
CHAR:
PUSH AX
MOV AH,0EH
INT 10H
POP AX
CMP AL,'R'
JNZ NSEND2
PUSH AX
PUSH DX
PUSH SI
LEA SI,MESS
L3:
MOV DX,03FDH
IN AL,DX
TEST AL,080H
JZ L3
TEST AL,040H
MOV AL,[SI]
CMP AL,'$'
JZ SEND2
MOV DX,03F8H
OUT DX,AL
INC SI
JMP L3
SEND2:
POP SI
POP DX
POP AX
JMP JOB
NSEND2:
CMP AL,0DH
JZ J1
JMP JOB
J1:
MOV AX,0E0AH
INT 10H
JMP L1
ERROR:
MOV DX,03F8H
IN AL,DX
MOV AL,'?'
MOV AH,14
INT 10H
JMP L1
MAIN ENDP
CODE ENDS
END START