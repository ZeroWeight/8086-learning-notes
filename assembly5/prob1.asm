DATA SEGMENT
GET DB 'GET:','$'
ERR DB 'ERROR!',0DH,0AH,'$'
COM DB 'DONE!',0DH,0AH,'$'
NEW DB 0DH,0AH,'$'
DATA ENDS
STACK SEGMENT PARA STACK
DB 1024 DUP(?)
STACK ENDS

CODE SEGMENT
ASSUME CS:CODE,DA:DATA,ES:DATA,SS:MYSTACK
START:
MOV AX,DATA
MOV DS,AX
MOV ES,AX
MOV AL,080H
MOV DX,03FBH
OUT DX,AL
MOV AX,0
MOV DX,03F9H
OUT DX,AL
MOV AX,60
MOV DX,3F8H
OUT DX,AL
MOV AL,0BH
MOV DX,03FBH
OUT DX,AL
MOV AL,013H
MOV DX,03FCH
OUT DX,AL
MOV AL,0
MOV DX,03F9H
OUT DX,AL
L1:
MOV DX,03FDH
IN AL,DX
TEST AL,01EH
JNZ ERROR
TEST AL,01H
JNZ REC
TEST AL,020H
JZ L1
MOV AH,1
INT 21H
CMP AL,20H
JE DONE
MOV CL,AL
MOV DX,03F8H
OUT DX,AL
JMP L1

REC:
LEA DX,GET
MOV AH,09H
INT 21H
MOV DX,03F8H
IN AL,DX
MOV DL,AL
MOV AL,02H
INT 21H
LEA DX,NEW
MOV AH,09H
INT 21H
JMP L1
ERROR:
LEA DX,ERR
MOV AH,09H
INT 21H
JMP L1

DONE:
LEA DX,COM
MOV AH,09H
INT 21H
MOV AX,04C00H
INT 21H
CODE ENDS
END START